{"version":3,"sources":["common.ts","country-features.ts","processing.ts","scene.ts","three-globe.ts","country-densities.ts","data-points.ts","vertex-shader.glsl","fragment-shader.glsl","chart.ts","ui-overlay.tsx","app.tsx","serviceWorker.ts","index.tsx"],"names":["responseToJson","response","a","json","getFeatureCountry","feature","properties","getFeatureState","removeChinaUs","fc","features","filter","f","admin","getCountryFeatures","res","fetch","preprocess","undefined","Promise","allSettled","map","r","cd","rewind","push","processCsseCovidData","path","countriesGeoJson","parseDate","d3","getCountry","country","state","find","countrygj","stategj","findStartDateIdx","keys","findIndex","k","d","Object","values","i","length","c","assert","data","s","t","j","v","idx","splice","columns","dates","dateStartIdx","key","date","processStatistics","requests","globals","funcs","Map","func","has","set","get","forEach","datas","finalized","startDate","createLatLngClickHandler","renderer","globe","camera","onClick","element","domElement","raycaster","THREE","mouse","startEvent","clientX","clientY","getEventPos","changedTouches","onClickGlobe","eventPos","Math","sqrt","pow","getBoundingClientRect","width","height","x","y","setFromCamera","intersects","intersectObjects","latlng","z","phi","acos","theta","atan2","lat","PI","lng","altitude","cartesian2Polar","point","sel","setStartEvent","on","processCountryDensities","countryDensities","countryDensity","sum","densities","density","getCountryDensities","getDecimation","decimation","isMobile","generateDatapoints","statsConfirmed","statsRecovered","statsDeaths","points","statMatch","sd","geoBounds","geometry","admin_1","genPoint","random","binarySearch","needle","max","min","u","startPoint","getNewCases","array","day","newCasesObj","num","prev","newCases","remainder","floor","statsConfirmedCasesObj","statsRecoveredCasesObj","statsDeadCasesObj","_","time","recoveredTime","pointsChanged","recovered","dead","startPointUpdate","pt","deadTime","spread","vertices","Float32Array","p","xyz","relAltitude","arguments","sin","cos","polar2Cartesian","flat","times","recoveredTimes","Number","POSITIVE_INFINITY","deadTimes","setAttribute","material","uniforms","value","vertexShader","fragmentShader","blending","blendEquation","blendSrc","blendSrcAlpha","blendDst","transparent","depthWrite","mesh","dispatcher","onBeforeRender","extinction_time","extinction","keep_deaths","keepDeaths","use_recovery_data","useRecoveryData","margin","calcRate","next","rate","isFinite","handleChange","UiOverlay","props","paused","setPaused","forceUpdate","useForceUpdate","useGlobal","propName","useState","helpExpanded","setHelpExpanded","parametersExpanded","setParametersExpanded","sourcesExpanded","setSourcesExpanded","dependenciesExpanded","setDependenciesExpanded","licenses","setLicenses","shownLicense","setShownLicense","extinctionEnabled","setExtinctionEnabled","setExtinction","setKeepDeaths","setUseRecoveryData","expanded","useEffect","li","className","Fade","in","IconButton","aria-label","Grow","unmountOnExit","Card","CardContent","Typography","variant","component","FormGroup","row","FormControlLabel","control","Checkbox","checked","onChange","label","Grid","container","spacing","item","xs","Slider","aria-labelledby","valueLabelDisplay","disabled","CardActions","Button","size","paragraph","Link","href","style","color","Collapse","timeout","name","l","repository","licenseText","license","Backdrop","open","TextField","multiline","InputProps","readOnly","App","rootElement","useRef","scene","setScene","setGlobe","setRenderer","setCamera","setCountriesGeoJson","setStatsConfirmed","setStatsRecovered","setStatsDeaths","setCountryDensities","selectedRegion","setSelectedRegion","_time","_paused","_intervalId","this","call","Date","valueOf","clearInterval","lastTime","setInterval","now","secondsElapsed","current","obj","ThreeGlobe","animateIn","globeImageUrl","bumpImageUrl","globeMaterial","polygonOffset","polygonOffsetFactor","polygonOffsetUnits","showAtmosphere","appendChild","add","position","cameraControls","OrbitControls","minDistance","rotateSpeed","zoomSpeed","ResizeObserver","setSize","aspect","updateProjectionMatrix","observe","animate","update","render","requestAnimationFrame","initScene","geopt","countryName","stateName","selectedRegionLines","remove","GeoJsonGeometry","GLOBE_RADIUS","then","myLine","selectAll","exit","svg","enter","append","attr","dataConfirmed","dataDeaths","confirmed","deaths","countryFilter","confirmedRate","deathsRate","node","domain","rescaled","yConfirmed","nice","yDeaths","yRate","xAxisD3","tickSizeOuter","yConfirmedAxisD3","yDeathsAxisD3","yConfirmedAxis","yDeathsAxis","confirmedLine","defined","isNaN","deathsLine","rateLine","defs","confirmedSeries","deathsSeries","confirmedRateSeries","deathsRateSeries","createLine","datum","line","chartOverlay","currentTimeDrag","currentTime","lastDate","updateTimeIndicator","xp","xAxis","getClientPointDate","evt","cp","type","target","invert","classed","text","dragState","currentTimeDragd3","d3zoom","previousSize","zoom","extent","zoomed","transform","rescaleX","scale","select","zooming","scaleExtent","range","generateChart","theme","React","useMemo","createMuiTheme","palette","primary","main","ThemeProvider","ref","Boolean","window","location","hostname","match","ReactDOM","StrictMode","document","getElementById","navigator","serviceWorker","ready","registration","unregister","catch","error","console","message"],"mappings":"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","file":"static/js/main.3b29b39f.chunk.js","sourcesContent":["export const responseToJson = async (response: Promise<Response>) => await (await response).json();\n","import { FeatureCollection, Feature } from \"geojson\";\nimport { responseToJson } from \"./common\";\n// @ts-ignore\nimport rewind from \"@mapbox/geojson-rewind\";\n\nexport const getFeatureCountry = (feature?: Feature) =>\n  (feature?.properties as any)?.[\"ADMIN\"] ?? (feature?.properties as any)?.[\"admin\"] ?? (feature?.properties as any)?.[\"NAME_0\"];\nexport const getFeatureState = (feature?: Feature) => (feature?.properties as any)?.[\"name\"] ?? (feature?.properties as any)?.[\"NAME_1\"];\n\nconst removeChinaUs = (fc: FeatureCollection) => {\n  fc.features = fc.features.filter((f) => {\n    const admin = getFeatureCountry(f);\n\n    return admin !== \"China\" && admin !== \"United States of America\";\n  });\n};\n\nexport async function getCountryFeatures(): Promise<FeatureCollection | undefined> {\n  const res = [\n    { fetch: fetch(\"./ne_110m_admin_0_countries.geojson\"), preprocess: removeChinaUs },\n    fetch(\"./ne_110m_admin_1_states_provinces.geojson\"),\n    fetch(\"./gadm36_CHN_1.json\"),\n  ];\n\n  let fc: FeatureCollection | undefined = undefined;\n\n  await Promise.allSettled(\n    res.map(async (r) => {\n      const cd = (await responseToJson((r as any).fetch ?? r)) as FeatureCollection;\n\n      rewind(cd, true);\n\n      (r as any).preprocess?.(cd);\n\n      if (fc === undefined) fc = cd;\n      else fc.features.push(...cd.features);\n    })\n  );\n\n  return fc;\n}\n","import * as d3 from \"d3\";\nimport { Feature, FeatureCollection } from \"geojson\";\nimport assert from \"assert\";\nimport { getFeatureCountry, getFeatureState } from \"./country-features\";\nimport { CovidStatistics, GlobalsType } from \"./types\";\n\nexport const processCsseCovidData = async (\n  path = \"https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_confirmed_global.csv\",\n  countriesGeoJson: FeatureCollection\n): Promise<CovidStatistics> => {\n  const parseDate = d3.timeParse(\"%-m/%-d/%y\");\n\n  const getCountry = (country: string, state: string | undefined = undefined) => {\n    const f = countriesGeoJson.features.find((feature: Feature) => {\n      const countrygj = getFeatureCountry(feature);\n      const stategj = getFeatureState(feature);\n\n      return countrygj === country && stategj === state;\n    });\n\n    return f;\n  };\n\n  const findStartDateIdx = (keys: string[]) => {\n    return keys.findIndex((k) => {\n      return parseDate(k) !== null;\n    });\n  };\n\n  const data = await d3.csv(path, (d) => {\n    let [country, state] = [\n      (d[\"Country/Region\"] ?? d[\"Country_Region\"]) as string,\n      (d[\"Province/State\"] ?? d[\"Province_State\"]) as string | undefined,\n    ];\n    const keys = Object.keys(d);\n    const values = [];\n\n    if (state === \"\") state = undefined;\n\n    if (country === \"US\" && state === undefined) return;\n\n    if (country === \"US\") country = \"United States of America\"; // consistency is a nice thing\n\n    if (state !== undefined && !getCountry(country, state) && getCountry(country)) state = undefined;\n\n    const dateStartIdx = findStartDateIdx(keys);\n\n    for (let i = dateStartIdx; i < keys.length; ++i) {\n      const key = keys[i];\n      const c = d[key];\n\n      assert(c !== undefined);\n\n      values.push(+c);\n    }\n\n    return { country, state, values };\n  });\n\n  for (let i = 0; i < data.length; ++i) {\n    const s = data[i];\n\n    for (let j = i + 1; j < data.length; ++j) {\n      const t = data[j];\n\n      if (s.country === t.country && s.state === t.state) {\n        s.values = s.values.map((v, idx) => {\n          return v + t.values[idx];\n        });\n        data.splice(j, 1);\n        --j;\n      }\n    }\n  }\n\n  const keys = data.columns;\n  const dates: Date[] = [];\n  const dateStartIdx = findStartDateIdx(keys);\n\n  for (let i = dateStartIdx; i < keys.length; ++i) {\n    const key = keys[i];\n    const date = parseDate(key);\n\n    assert(date);\n\n    dates.push(date);\n  }\n\n  return { dates, data };\n};\n\nexport type StatisticsRequests = { path: string; func: Function; data?: CovidStatistics }[];\n\nexport const processStatistics = async (requests: StatisticsRequests, countriesGeoJson: FeatureCollection, globals: GlobalsType) => {\n  const funcs = new Map<Function, CovidStatistics[]>();\n  await Promise.allSettled(\n    requests.map(async (r) => {\n      const { func, path } = r;\n      const data = await processCsseCovidData(path, countriesGeoJson);\n\n      if (!funcs.has(func)) funcs.set(func, []);\n\n      funcs.get(func)!.push(data);\n    })\n  );\n\n  // FIXME: Handle different dates\n\n  [...funcs.keys()].forEach((func) => {\n    const datas = funcs.get(func)!;\n    const finalized: CovidStatistics = {\n      data: [],\n      dates: [],\n    };\n\n    for (const data of datas) {\n      if (finalized.dates.length === 0) finalized.dates = data.dates;\n\n      finalized.data.push(...data.data);\n    }\n\n    if (globals.startDate === undefined) globals.startDate = finalized.dates[0];\n\n    func(finalized);\n  });\n};\n","import * as THREE from \"three\";\nimport { OrbitControls } from \"three/examples/jsm/controls/OrbitControls\";\nimport ThreeGlobe from \"three-globe\";\nimport * as d3 from \"d3\";\nimport { cartesian2Polar } from \"./three-globe\";\n\nexport const initScene = (element: HTMLDivElement) => {\n  const globe = new ThreeGlobe({ animateIn: false })\n    .globeImageUrl(\"./BATH_50M_2.png\")\n    .bumpImageUrl(\"//unpkg.com/three-globe/example/img/earth-topology.png\");\n\n  globe.globeMaterial().polygonOffset = true;\n  globe.globeMaterial().polygonOffsetFactor = 1;\n  globe.globeMaterial().polygonOffsetUnits = 1;\n\n  globe.showAtmosphere(true);\n\n  const renderer = new THREE.WebGLRenderer();\n  const scene = new THREE.Scene();\n  const camera = new THREE.PerspectiveCamera();\n\n  element.appendChild(renderer.domElement);\n\n  scene.add(new THREE.AmbientLight(0xbbbbbb));\n  scene.add(new THREE.DirectionalLight(0xffffff, 0.6));\n  scene.add(globe);\n\n  camera.position.x = 200;\n  camera.position.y = 200;\n\n  const cameraControls = new OrbitControls(camera, renderer.domElement);\n\n  cameraControls.minDistance = 101;\n  cameraControls.rotateSpeed = 0.5;\n  cameraControls.zoomSpeed = 1.6;\n\n  // Handle resize\n  const updateSize = () => {\n    const { width, height } = element.getBoundingClientRect();\n\n    renderer.setSize(width, height);\n    camera.aspect = width / height;\n    camera.updateProjectionMatrix();\n  };\n\n  const resizeObserver = new ResizeObserver(updateSize);\n\n  resizeObserver.observe(element);\n\n  (function animate() {\n    cameraControls.update();\n    renderer.render(scene, camera);\n    requestAnimationFrame(animate);\n  })();\n\n  return { renderer, scene, camera, globe };\n};\n\nexport function createLatLngClickHandler({\n  renderer,\n  globe,\n  camera,\n  onClick,\n}: {\n  renderer: THREE.WebGLRenderer;\n  globe: ThreeGlobe;\n  camera: THREE.PerspectiveCamera;\n  onClick: Function;\n}) {\n  const element = renderer.domElement;\n  const raycaster = new THREE.Raycaster();\n  const mouse = new THREE.Vector2();\n  let startEvent: { clientX: number; clientY: number } = { clientX: 0, clientY: 0 };\n\n  const getEventPos = () => {\n    return {\n      clientX: d3.event.clientX ?? d3.event.changedTouches[0].clientX,\n      clientY: d3.event.clientY ?? d3.event.changedTouches[0].clientY,\n    };\n  };\n\n  const onClickGlobe = () => {\n    const eventPos = getEventPos();\n\n    const delta = Math.sqrt(Math.pow(startEvent.clientX - eventPos.clientX, 2) + Math.pow(startEvent.clientY - eventPos.clientY, 2));\n\n    if (delta > 5) return; // drag, not click\n\n    const { width, height } = element.getBoundingClientRect();\n\n    mouse.x = (eventPos.clientX / width) * 2 - 1;\n    mouse.y = -(eventPos.clientY / height) * 2 + 1;\n\n    raycaster.setFromCamera(mouse, camera);\n\n    var intersects = raycaster.intersectObjects([globe], true);\n\n    if (intersects.length > 0) {\n      const latlng = cartesian2Polar(intersects[0].point);\n\n      onClick(latlng);\n    } else onClick();\n  };\n\n  const sel = d3.select(element);\n\n  const setStartEvent = () => {\n    startEvent = getEventPos();\n  };\n\n  sel.on(\"mousedown\", setStartEvent);\n  sel.on(\"click\", onClickGlobe);\n  sel.on(\"touchstart\", setStartEvent);\n  sel.on(\"touchend\", onClickGlobe);\n}\n","// the following functions are adapted from three-globe, because it doesn't export it\nimport { LatLng } from \"leaflet\";\n\nexport const GLOBE_RADIUS = 100;\n\nfunction polar2Cartesian({ lat, lng }: LatLng) {\n  const relAltitude = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;\n  const phi = ((90 - lat) * Math.PI) / 180;\n  const theta = ((90 - lng) * Math.PI) / 180;\n  const r = GLOBE_RADIUS * (1 + relAltitude);\n  return {\n    x: r * Math.sin(phi) * Math.cos(theta),\n    y: r * Math.cos(phi),\n    z: r * Math.sin(phi) * Math.sin(theta),\n  };\n}\n\ntype LatLngAlt = { lat: number; lng: number; altitude: number };\n\nfunction cartesian2Polar({ x, y, z }: { x: number; y: number; z: number }): LatLngAlt {\n  const r = Math.sqrt(x * x + y * y + z * z);\n  const phi = Math.acos(y / r);\n  const theta = Math.atan2(z, x);\n\n  return {\n    lat: 90 - (phi * 180) / Math.PI,\n    lng: 90 - (theta * 180) / Math.PI - (theta < -Math.PI / 2 ? 360 : 0), // keep within [-180, 180] boundaries\n    altitude: r / GLOBE_RADIUS - 1,\n  };\n}\n\nexport { polar2Cartesian, cartesian2Polar };\n","import Leaflet from \"leaflet\";\nimport { responseToJson } from \"./common\";\n\nexport type Density = { point: Leaflet.LatLng; density: number };\nexport type Densities = Density[];\nexport type CountryDensities = { densities: Densities; admin: string; admin_1: string };\n\nfunction processCountryDensities(json: object) {\n  const countryDensities = json as CountryDensities[];\n\n  countryDensities.forEach((countryDensity) => {\n    let sum = 0;\n\n    countryDensity.densities.forEach((d, idx) => {\n      countryDensity.densities[idx].density = Math.pow(countryDensity.densities[idx].density, 1);\n    });\n\n    // normalize densities per administrative region\n    countryDensity.densities.forEach((d) => {\n      sum += d.density;\n    });\n\n    countryDensity.densities.forEach((d, idx) => {\n      countryDensity.densities[idx].density /= sum;\n    });\n\n    sum = 0;\n\n    countryDensity.densities.forEach((d, idx) => {\n      countryDensity.densities[idx].density += sum;\n      sum = countryDensity.densities[idx].density;\n    });\n  });\n\n  return countryDensities;\n}\n\nexport const getCountryDensities = async () => {\n  const res = [fetch(\"./country-density.json\"), fetch(\"./china-density.json\"), fetch(\"./usa-density.json\")];\n\n  const countryDensities: CountryDensities[] = [];\n\n  await Promise.allSettled(\n    res.map(async (r) => {\n      const cd = processCountryDensities(await responseToJson(r));\n\n      countryDensities.push(...cd);\n    })\n  );\n\n  return countryDensities;\n};\n","/* eslint import/no-webpack-loader-syntax: off */\n\nimport { LatLng } from \"leaflet\";\nimport * as d3 from \"d3\";\nimport binarySearch from \"binary-search\";\nimport * as THREE from \"three\";\nimport { isMobile } from \"mobile-device-detect\";\nimport { CountryDensities, Densities, Density } from \"./country-densities\";\nimport { FeatureCollection, Feature } from \"geojson\";\nimport { CovidStatistics, CovidStatisticsDataForRegion } from \"./types\";\n// @ts-ignore\nimport vertexShader from \"!!raw-loader!./vertex-shader.glsl\";\n// @ts-ignore\nimport fragmentShader from \"!!raw-loader!./fragment-shader.glsl\";\nimport { getFeatureCountry, getFeatureState } from \"./country-features\";\nimport { polar2Cartesian } from \"./three-globe\";\n\nexport const getDecimation = () => {\n  let decimation = 10; // FIXME: Should be handled dynamically\n\n  if (isMobile) {\n    decimation = 30;\n  }\n\n  return decimation;\n};\n\nexport const generateDatapoints = (\n  densities: CountryDensities[],\n  countriesGeoJson: FeatureCollection,\n  globals: any,\n  statsConfirmed: CovidStatistics,\n  statsRecovered: CovidStatistics,\n  statsDeaths: CovidStatistics\n) => {\n  let points: {\n    point: LatLng;\n    time: number;\n    recoveredTime?: number;\n    deadTime?: number;\n  }[] = [];\n\n  type GeoPt = [number, number];\n  type GeoBounds = [GeoPt, GeoPt];\n\n  let countries: {\n    geoBounds: GeoBounds;\n    feature: Feature;\n    densities?: Densities;\n    statsConfirmed?: number[];\n    statsRecovered?: number[];\n    statsDeaths?: number[];\n  }[] = countriesGeoJson.features.map((feature: Feature) => {\n    const country = getFeatureCountry(feature);\n    const state = getFeatureState(feature);\n\n    const statMatch = (sd: CovidStatisticsDataForRegion) => sd.country === country && sd.state === state;\n\n    return {\n      geoBounds: d3.geoBounds(feature.geometry),\n      feature,\n      densities: densities.find((density) => density.admin === country && density.admin_1 === state)?.densities,\n      statsConfirmed: statsConfirmed.data.find(statMatch)?.values,\n      statsRecovered: statsRecovered.data.find(statMatch)?.values,\n      statsDeaths: statsDeaths.data.find(statMatch)?.values,\n    };\n  });\n\n  countries.forEach((country) => {\n    if (!country.statsConfirmed) return;\n\n    const genPoint = (country: any) => {\n      const x = Math.random();\n\n      let idx = binarySearch(country.densities, { density: x } as Density, (element: Density, needle: Density) => {\n        return element.density - needle.density;\n      });\n\n      if (idx < 0) idx = -idx - 1;\n\n      idx = Math.max(0, Math.min(country.densities.length - 1, idx));\n\n      const point = { ...country.densities[idx].point };\n\n      point.lat += u();\n      point.lng += u();\n\n      return point;\n    };\n\n    const s = 360 / 4096 / 2;\n    const u = () => (Math.random() * 2 - 1) * s;\n    const decimation = getDecimation();\n    const startPoint = points.length;\n\n    const getNewCases = (array: number[], day: number, newCasesObj: { newCases?: number; remainder?: number } = {}) => {\n      const num = array[day] ?? 0;\n      const prev = array[day - 1] ?? 0;\n      let newCases = (num - prev) / decimation;\n      let remainder = newCasesObj.remainder ?? 0;\n\n      remainder += newCases - Math.floor(newCases);\n\n      if (remainder >= 1) {\n        const x = Math.floor(remainder);\n        newCases += x;\n        remainder -= x;\n      }\n\n      newCasesObj.remainder = remainder;\n\n      return Math.floor(newCases);\n    };\n\n    const statsConfirmedCasesObj = {};\n    const statsRecoveredCasesObj = {};\n    const statsDeadCasesObj = {};\n\n    if (!country.statsConfirmed) return;\n\n    country.statsConfirmed.forEach((_, day) => {\n      const newCases = getNewCases(country.statsConfirmed!, day, statsConfirmedCasesObj);\n\n      for (let i = 0; i < newCases; ++i) {\n        points.push({\n          point: genPoint(country),\n          time: day,\n          recoveredTime: day + 14, // FIXME: Recovery is currently assumed to be within two weeks, if there is no recovery/death data.\n        });\n      }\n    });\n\n    let pointsChanged: { recovered: number; dead: number }[] = country.statsConfirmed.map(() => ({ recovered: 0, dead: 0 }));\n\n    country.statsRecovered?.forEach((_, day) => {\n      const newCases = getNewCases(country.statsRecovered!, day, statsRecoveredCasesObj);\n\n      pointsChanged[day].recovered += newCases;\n    });\n\n    country.statsDeaths?.forEach((_, day) => {\n      const newCases = getNewCases(country.statsDeaths!, day, statsDeadCasesObj);\n\n      pointsChanged[day].dead += newCases;\n    });\n\n    let startPointUpdate = startPoint;\n\n    pointsChanged.forEach((c, day) => {\n      for (let i = 0; i < c.dead; ++i) {\n        const pt = points[startPointUpdate++];\n\n        if (pt === undefined) return; // exhausted points, inconsistent data?\n\n        pt.recoveredTime = undefined;\n        pt.deadTime = day;\n      }\n\n      for (let i = 0; i < c.recovered; ++i) {\n        const pt = points[startPointUpdate++];\n\n        if (pt === undefined) return; // exhausted points, inconsistent data?\n\n        pt.recoveredTime = day;\n      }\n    });\n  });\n\n  // Spread each point across a day, as EFHIII does\n  points.forEach((_, idx) => {\n    const spread = Math.random();\n\n    points[idx].time += spread;\n    if (points[idx].recoveredTime !== undefined) points[idx].recoveredTime! += spread;\n    if (points[idx].deadTime !== undefined) points[idx].deadTime! += spread;\n  });\n\n  const geometry = new THREE.BufferGeometry();\n  const vertices = new Float32Array(\n    points\n      .map((p: any) => {\n        const xyz = polar2Cartesian(p.point);\n        return [xyz.x, xyz.y, xyz.z];\n      })\n      .flat()\n  );\n\n  const times = new Float32Array(points.map((p) => p.time));\n  const recoveredTimes = new Float32Array(points.map((p) => p.recoveredTime ?? Number.POSITIVE_INFINITY));\n  const deadTimes = new Float32Array(points.map((p) => p.deadTime ?? Number.POSITIVE_INFINITY));\n\n  geometry.setAttribute(\"position\", new THREE.BufferAttribute(vertices, 3));\n  geometry.setAttribute(\"confirmed_time\", new THREE.BufferAttribute(times, 1));\n  geometry.setAttribute(\"recovered_time\", new THREE.BufferAttribute(recoveredTimes, 1));\n  geometry.setAttribute(\"dead_time\", new THREE.BufferAttribute(deadTimes, 1));\n\n  const material = new THREE.ShaderMaterial({\n    uniforms: {\n      time: { value: 0 },\n    },\n    vertexShader,\n    fragmentShader,\n    blending: THREE.CustomBlending,\n    blendEquation: THREE.AddEquation,\n    blendSrc: THREE.SrcAlphaFactor,\n    blendSrcAlpha: THREE.OneFactor,\n    blendDst: THREE.OneFactor,\n    transparent: true,\n    depthWrite: false,\n  });\n  const mesh = new THREE.Points(geometry, material);\n\n  globals.dispatcher.on(\"timeChanged.data-points\", (time: number) => {\n    material.uniforms.time.value = time;\n  });\n\n  mesh.onBeforeRender = () => {\n    material.uniforms.extinction_time = { value: globals.extinction };\n    material.uniforms.keep_deaths = { value: globals.keepDeaths };\n    material.uniforms.use_recovery_data = { value: globals.useRecoveryData };\n  };\n\n  return mesh;\n};\n","export default \"uniform float time;\\nuniform bool use_recovery_data;\\nattribute float confirmed_time;\\nvarying float var_confirmed_time;\\nattribute float recovered_time;\\nvarying float var_recovered_time;\\nattribute float dead_time;\\nvarying float var_dead_time;\\nvarying float circle_blend_factor;\\n\\nconst float minsize = 1.;\\nconst float maxsize = 7.;\\nconst float dead_maxsize = 14.;\\nconst float big_value = 1e30;\\n\\nvoid main() {\\n  var_confirmed_time = confirmed_time;\\n  var_recovered_time = use_recovery_data ? recovered_time : big_value;\\n  var_dead_time = dead_time;\\n\\n  vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\\n  float x = time - confirmed_time;\\n  float y = time - dead_time;\\n\\n  if (x < 0.)\\n    x = 0.;\\n  else\\n    x = mix(minsize, maxsize, exp(-x));\\n\\n  if (y >= 0.)\\n    x = mix(minsize, dead_maxsize, exp(-y));\\n\\n  circle_blend_factor = min(max(0., x - 1.), 1.);\\n\\n  gl_PointSize = x;\\n  gl_Position = projectionMatrix * mvPosition;\\n}\\n\";","export default \"uniform float time;\\nuniform float extinction_time;\\nuniform bool keep_deaths;\\nvarying float var_confirmed_time;\\nvarying float var_recovered_time;\\nvarying float var_dead_time;\\nvarying float circle_blend_factor;\\n\\nconst vec3 confirmed_color = vec3(0., 0., 1.);\\nconst vec3 recovered_color = vec3(0., .25, 0.);\\nconst vec3 dead_color = vec3(1., 0., 0.);\\n\\nconst float big_value = 1e30;\\n\\nvoid main() {\\n  float x = time - var_confirmed_time;\\n  float y = x;\\n\\n  if (x < 0.)\\n    x = 0.;\\n  else\\n    x = 1.;\\n  if (y < 0.)\\n    y = 0.;\\n  else\\n    y = exp(-y * 10.);\\n\\n  float blend = max(0., 1. - length(gl_PointCoord.st * 2. - 1.));\\n  float blur = .01;\\n\\n  blend = smoothstep(.5 - blur, .5 + blur, blend);\\n  blend = mix(1., blend, circle_blend_factor);\\n\\n  float extinct_time = var_confirmed_time + extinction_time;\\n\\n  if (keep_deaths && var_dead_time < big_value) {\\n    extinct_time = big_value;\\n  }\\n\\n  float z = time - extinct_time;\\n\\n  if (z >= 0.)\\n    blend = mix(0., blend, exp(-z));\\n\\n  vec3 color = confirmed_color * x;\\n\\n  color = mix(color, recovered_color,\\n              max(0., min(1., time - var_recovered_time - 1.)));\\n\\n  if (time - var_dead_time >= 0.)\\n    color = dead_color;\\n\\n  color += vec3(1e-2);\\n\\n  gl_FragColor = vec4(color, blend * x);\\n}\";","import * as d3 from \"d3\";\nimport { CovidStatistics, GlobalsType, CovidStatisticsDataForRegion } from \"./types\";\n\nconst margin = [112, 96];\n\ntype DatumType = {\n  value: number | undefined;\n  date: Date;\n};\n\nfunction calcRate(array: number[]): (number | undefined)[] {\n  return array.map((next, idx) => {\n    const prev = array[idx - 1] ?? 0;\n    const rate = next / prev;\n\n    if (!Number.isFinite(rate)) return undefined;\n\n    return rate;\n  });\n}\n\nexport const generateChart = ({\n  element,\n  globals,\n  statsConfirmed,\n  statsDeaths,\n  selectedRegion,\n}: {\n  element: HTMLDivElement;\n  globals: GlobalsType;\n  statsConfirmed: CovidStatistics;\n  statsDeaths: CovidStatistics;\n  selectedRegion?: string;\n}) => {\n  d3.select(element).selectAll(\"svg#chart\").data([]).exit().remove();\n\n  const svg = d3.select(element).selectAll(\"svg#chart\").data([0]).enter().append(\"svg\").attr(\"id\", \"chart\");\n\n  const { dates, data: dataConfirmed } = statsConfirmed;\n  const { data: dataDeaths } = statsDeaths;\n  const confirmed: number[] = [];\n  const deaths: number[] = [];\n\n  const countryFilter = (d: CovidStatisticsDataForRegion) => {\n    return selectedRegion === undefined || d.country === selectedRegion || d.state === selectedRegion;\n  };\n\n  dataConfirmed.forEach((d) => {\n    if (!countryFilter(d)) return;\n\n    d.values.forEach((v, idx) => {\n      confirmed[idx] = (confirmed[idx] ?? 0) + v;\n    });\n  });\n\n  dataDeaths.forEach((d) => {\n    if (!countryFilter(d)) return;\n\n    d.values.forEach((v, idx) => {\n      deaths[idx] = (deaths[idx] ?? 0) + v;\n    });\n  });\n\n  const confirmedRate: (number | undefined)[] = calcRate(confirmed);\n  const deathsRate: (number | undefined)[] = calcRate(deaths);\n\n  const node = svg.node() as Element;\n\n  const x = d3.scaleTime().domain(d3.extent(dates) as [Date, Date]);\n\n  const rescaled = { x };\n\n  const yConfirmed = d3\n    .scaleLinear()\n    .domain([0, d3.max(confirmed) as number])\n    .nice();\n\n  const yDeaths = d3\n    .scaleLinear()\n    .domain([0, d3.max(deaths) as number])\n    .nice();\n\n  const rateDomain = [1, 1.25];\n\n  const yRate = d3.scaleLinear().domain(rateDomain).nice();\n\n  const xAxisD3 = d3.axisBottom(x).tickSizeOuter(0);\n  const yConfirmedAxisD3 = d3.axisLeft(yConfirmed);\n  const yDeathsAxisD3 = d3.axisRight(yDeaths);\n\n  const yConfirmedAxis = svg.append(\"g\").attr(\"class\", \"y-confirmed-axis\").call(yConfirmedAxisD3);\n\n  const yDeathsAxis = svg.append(\"g\").attr(\"class\", \"y-deaths-axis\").call(yDeathsAxisD3);\n\n  const confirmedLine = d3\n    .line()\n    .defined((d: any) => !isNaN(d.value))\n    .x((d: any) => rescaled.x(d.date))\n    .y((d: any) => yConfirmed(d.value));\n\n  const deathsLine = d3\n    .line()\n    .defined((d: any) => !isNaN(d.value))\n    .x((d: any) => rescaled.x(d.date))\n    .y((d: any) => yDeaths(d.value));\n\n  const rateLine = d3\n    .line()\n    .defined((d: any) => !isNaN(d.value))\n    .x((d: any) => rescaled.x(d.date))\n    .y((d: any) => yRate(d.value));\n\n  const defs = svg.append(\"defs\").append(\"clipPath\").attr(\"id\", \"clip\").append(\"rect\");\n\n  const confirmedSeries = confirmed.map((x: number, idx: number) => ({\n    value: x,\n    date: dates[idx],\n  }));\n\n  const deathsSeries = deaths.map((x: number, idx: number) => ({\n    value: x,\n    date: dates[idx],\n  }));\n\n  const confirmedRateSeries = confirmedRate.map((x: number | undefined, idx: number) => ({\n    value: x,\n    date: dates[idx],\n  }));\n\n  const deathsRateSeries = deathsRate.map((x: number | undefined, idx: number) => ({\n    value: x,\n    date: dates[idx],\n  }));\n\n  const createLine = (datum: DatumType[], line: d3.Line<[number, number]>) => {\n    const path = svg\n      .append(\"path\")\n      .datum(datum)\n      .attr(\"class\", \"path\")\n      .attr(\"fill\", \"none\")\n      .attr(\"clip-path\", \"url(#clip)\")\n      .attr(\"stroke-width\", 1.5)\n      .attr(\"d\", line as any);\n\n    return path;\n  };\n\n  createLine(confirmedRateSeries, rateLine).attr(\"stroke\", \"steelblue\").attr(\"stroke-opacity\", \"33%\").attr(\"class\", \"rate-path\");\n\n  createLine(deathsRateSeries, rateLine).attr(\"stroke\", \"red\").attr(\"stroke-opacity\", \"33%\").attr(\"class\", \"rate-path\");\n\n  createLine(confirmedSeries, confirmedLine).attr(\"stroke\", \"steelblue\").attr(\"class\", \"confirmed-path\");\n\n  createLine(deathsSeries, deathsLine).attr(\"stroke\", \"red\").attr(\"class\", \"deaths-path\");\n\n  var chartOverlay = svg.append(\"g\").attr(\"clip-path\", \"url(#clip)\").attr(\"class\", \"chart-overlay\");\n\n  const currentTimeDrag = chartOverlay\n    .append(\"path\")\n    .attr(\"class\", \"current-time current-time-drag\")\n    .style(\"stroke\", \"yellow\")\n    .style(\"stroke-width\", \"16px\");\n\n  chartOverlay.append(\"path\").attr(\"class\", \"current-time\").style(\"stroke\", \"red\").style(\"stroke-width\", \"1px\");\n\n  const currentTime = chartOverlay.selectAll(\".current-time\");\n\n  let lastDate: Date | undefined = undefined;\n\n  const updateTimeIndicator = (date: Date | undefined = undefined) => {\n    if (date !== undefined) {\n      lastDate = date;\n    } else date = lastDate;\n\n    if (date === undefined) return;\n\n    const { /*width, */ height } = node.getBoundingClientRect();\n    const xp = rescaled.x(date);\n\n    currentTime\n      .datum([\n        [xp, margin[1]],\n        [xp, height - margin[1]],\n      ])\n      .attr(\"d\", d3.line() as any);\n  };\n\n  globals.dispatcher.on(\"timeChanged.chart\", (time: number, date: Date) => updateTimeIndicator(date));\n\n  const xAxis = svg.append(\"g\").attr(\"clip-path\", \"url(#clip)\").append(\"g\").attr(\"class\", \"x-axis\").call(xAxisD3);\n\n  svg\n    .append(\"text\")\n    .classed(\"title\", true)\n    .attr(\"x\", \"50%\")\n    .attr(\"y\", 64)\n    .text(selectedRegion ?? \"Global\");\n\n  svg.append(\"text\").classed(\"legend-left\", true).attr(\"x\", \"0%\").attr(\"y\", 128).text(\"Confirmed\");\n\n  svg.append(\"text\").classed(\"legend-right\", true).attr(\"x\", \"100%\").attr(\"y\", 128).text(\"Deaths\");\n\n  function getClientPointDate() {\n    const evt = d3.event;\n    const cp = (evt.type === \"drag\" && [evt.x, evt.y]) || d3.clientPoint(evt.target, evt);\n    const d = rescaled.x.invert(cp[0]);\n\n    return d;\n  }\n\n  svg.on(\"click\", () => {\n    globals.date = getClientPointDate();\n  });\n\n  const dragState = { paused: false };\n  const currentTimeDragd3 = d3\n    .drag()\n    .on(\"start\", () => {\n      dragState.paused = globals.paused;\n      globals.paused = true;\n    })\n    .on(\"end\", () => {\n      globals.paused = dragState.paused;\n    })\n    .on(\"drag\", () => {\n      globals.date = getClientPointDate();\n    });\n\n  currentTimeDrag.call(currentTimeDragd3 as any);\n\n  let previousSize: { width?: number; height?: number } = {};\n  let d3zoom: d3.ZoomBehavior<Element, unknown>;\n\n  const zoom = (svg: any) => {\n    const { width, height } = node.getBoundingClientRect();\n\n    const extent: [[number, number], [number, number]] = [\n      [margin[0], margin[1]],\n      [width - margin[0], height - margin[1]],\n    ];\n\n    const zoomed = () => {\n      const transform = d3.event?.transform ?? d3.zoomTransform(svg.node());\n\n      rescaled.x = transform.rescaleX(x);\n\n      svg.selectAll(\".confirmed-path\").attr(\"d\", confirmedLine);\n\n      svg.selectAll(\".deaths-path\").attr(\"d\", deathsLine);\n\n      svg.selectAll(\".rate-path\").attr(\"d\", rateLine);\n\n      xAxisD3.scale(rescaled.x);\n\n      svg.select(\".x-axis\").call(xAxisD3);\n\n      updateTimeIndicator();\n    };\n\n    const zooming = d3\n      .zoom()\n      .scaleExtent([1, 20])\n      //.translateExtent(extent)\n      .extent(extent)\n      .on(\"zoom\", zoomed);\n\n    d3zoom = zooming;\n\n    svg.call(zooming);\n    zoomed();\n  };\n\n  // Handle resize\n  const updateSize = () => {\n    if (!node) return;\n\n    const { width, height } = node.getBoundingClientRect();\n\n    x.range([0 + margin[0], width - margin[0]]);\n    [yConfirmed, yDeaths, yRate].forEach((y) => y.range([height - margin[1], 0 + margin[1]]));\n    xAxis.attr(\"transform\", `translate(0,${height - margin[1]})`).call(xAxisD3);\n    yConfirmedAxis.attr(\"transform\", `translate(${0 + margin[0]},0)`).call(yConfirmedAxisD3);\n    yDeathsAxis.attr(\"transform\", `translate(${width - margin[0]},0)`).call(yDeathsAxisD3);\n    defs\n      .attr(\"x\", margin[0])\n      .attr(\"y\", margin[1])\n      .attr(\"width\", width - margin[0] * 2)\n      .attr(\"height\", height - margin[1]);\n\n    if (previousSize.width !== undefined) {\n      svg.call(d3zoom.transform as any, d3.zoomIdentity); // FIXME: Should update transform for new size\n    }\n\n    previousSize = { width, height };\n\n    svg.call(zoom);\n  };\n\n  const resizeObserver = new ResizeObserver(updateSize);\n\n  resizeObserver.observe(element);\n};\n","import React, { useState, useEffect } from \"react\";\nimport Card from \"@material-ui/core/Card\";\nimport CardActions from \"@material-ui/core/CardActions\";\nimport CardContent from \"@material-ui/core/CardContent\";\nimport Button from \"@material-ui/core/Button\";\nimport Typography from \"@material-ui/core/Typography\";\nimport HelpIcon from \"@material-ui/icons/Help\";\nimport PlayArrowIcon from \"@material-ui/icons/PlayArrow\";\nimport PauseIcon from \"@material-ui/icons/Pause\";\nimport IconButton from \"@material-ui/core/IconButton\";\nimport TuneIcon from \"@material-ui/icons/Tune\";\nimport { Collapse, Fade, Grow, Link, Backdrop, TextField, Slider, Grid, FormGroup, FormControlLabel, Checkbox } from \"@material-ui/core\";\nimport useForceUpdate from \"use-force-update\";\nimport { getDecimation } from \"./data-points\";\nimport { responseToJson } from \"./common\";\n\nfunction handleChange<T>(f: (v: T) => void) {\n  return (_: React.ChangeEvent<{}>, v: any) => f(v as T);\n}\n\nexport default function UiOverlay(props: any) {\n  const { paused, setPaused, globals } = props;\n  const forceUpdate = useForceUpdate();\n\n  const useGlobal = <T extends unknown>(propName: string): [T, (v: T) => void] => {\n    return [\n      globals[propName] as T,\n      (v: T) => {\n        globals[propName] = v;\n        forceUpdate();\n      },\n    ];\n  };\n\n  const [helpExpanded, setHelpExpanded] = useState<boolean>(false);\n  const [parametersExpanded, setParametersExpanded] = useState<boolean>(false);\n  const [sourcesExpanded, setSourcesExpanded] = useState<boolean>(false);\n  const [dependenciesExpanded, setDependenciesExpanded] = useState<boolean>(false);\n  const [licenses, setLicenses] = useState<any>();\n  const [shownLicense, setShownLicense] = useState<string>();\n  const [extinctionEnabled, setExtinctionEnabled] = useState<boolean>(true);\n  const [extinction, setExtinction] = useState<number>(globals.extinction);\n  const [keepDeaths, setKeepDeaths] = useGlobal<boolean>(\"keepDeaths\");\n  const [useRecoveryData, setUseRecoveryData] = useGlobal<boolean>(\"useRecoveryData\");\n  const expanded = helpExpanded || parametersExpanded;\n\n  useEffect(() => {\n    if (licenses !== undefined || !dependenciesExpanded) return;\n\n    (async () => {\n      const li = await responseToJson(fetch(\"./licenseInfos.json\"));\n\n      setLicenses(li);\n    })();\n  }, [dependenciesExpanded, licenses]);\n\n  useEffect(() => {\n    globals.extinction = extinctionEnabled ? extinction : Number.POSITIVE_INFINITY;\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [extinction, extinctionEnabled]);\n\n  return (\n    <div className=\"ui-overlay\">\n      <Fade in={!expanded}>\n        <div className=\"buttons\">\n          <IconButton aria-label=\"pause toggle\" onClick={() => setPaused(!paused)} className=\"pause-toggle\">\n            {paused ? <PlayArrowIcon /> : <PauseIcon />}\n          </IconButton>\n          <IconButton aria-label=\"change visualization parameters\" onClick={() => setParametersExpanded(true)} className=\"parameters\">\n            <TuneIcon />\n          </IconButton>\n          <IconButton aria-label=\"help\" onClick={() => setHelpExpanded(true)} className=\"help\">\n            <HelpIcon />\n          </IconButton>\n        </div>\n      </Fade>\n      <Grow in={parametersExpanded} unmountOnExit>\n        <div className=\"info-card\">\n          <Card>\n            <CardContent className=\"description\">\n              <Typography variant=\"h5\" component=\"h2\">\n                Visualization parameters\n              </Typography>\n              <FormGroup row>\n                <FormControlLabel\n                  control={<Checkbox checked={extinctionEnabled} onChange={handleChange(setExtinctionEnabled)} />}\n                  label=\"Extinction\"\n                />\n              </FormGroup>\n              <Grid container spacing={2}>\n                <Grid item xs>\n                  <Slider\n                    value={extinction}\n                    onChange={handleChange(setExtinction)}\n                    aria-labelledby=\"extinction\"\n                    valueLabelDisplay=\"auto\"\n                    disabled={!extinctionEnabled}\n                    min={1}\n                  />\n                </Grid>\n                <Grid item>\n                  <Typography>\n                    {extinction} day{extinction > 1 ? `s` : null}\n                  </Typography>\n                </Grid>\n              </Grid>\n              <FormGroup row>\n                <FormControlLabel control={<Checkbox checked={keepDeaths} onChange={handleChange(setKeepDeaths)} />} label=\"Keep deaths\" />\n                <FormControlLabel\n                  control={<Checkbox checked={useRecoveryData} onChange={handleChange(setUseRecoveryData)} />}\n                  label=\"Use recovery data\"\n                />\n              </FormGroup>\n            </CardContent>\n            <CardActions>\n              <Button size=\"small\" onClick={() => setParametersExpanded(false)}>\n                Dismiss\n              </Button>\n            </CardActions>\n          </Card>\n        </div>\n      </Grow>\n      <Grow in={helpExpanded} unmountOnExit>\n        <div className=\"info-card\">\n          <Card>\n            <CardContent className=\"description\">\n              <Typography variant=\"h5\" component=\"h2\">\n                COVID-19 Visualizer\n              </Typography>\n\n              <Typography paragraph>\n                This webapp fetches the latest <Link href=\"https://github.com/CSSEGISandData/COVID-19\">JHU CSSE COVID-19 Data</Link> and generates a\n                point-based visualization in <Link href=\"https://threejs.org/\">three.js</Link> on top of a{\" \"}\n                <Link href=\"https://github.com/vasturiano/three-globe\">ThreeJS Globe Visualization</Link>. This visualization largely follows the same\n                approach as in <Link href=\"https://github.com/EFHIII/COVID-19\">Edward Haas's COVID-19 Confirmed cases map over time</Link>, but with\n                interactive parameters (e.g. point extinction) and processed in real-time using the latest data.\n              </Typography>\n\n              <Typography paragraph>Each point in the visualizer represents {getDecimation()} cases.</Typography>\n\n              <ul>\n                <li>\n                  <Typography>\n                    <span style={{ color: \"steelblue\" }}>Blue</span> represents confirmed cases\n                  </Typography>\n                </li>\n                <li>\n                  <Typography>\n                    <span style={{ color: \"red\" }}>Red</span> represents deaths\n                  </Typography>\n                </li>\n                <li>\n                  <Typography>\n                    <span style={{ color: \"green\" }}>Green</span> represents recovered cases\n                    <br />\n                    In many cases, the recovered case data is unreliable or missing. This visualizer assumes a recovery time of 14 days if no other\n                    data is available.\n                  </Typography>\n                </li>\n              </ul>\n\n              <Typography paragraph>The points are positioned randomly within each region according to population density.</Typography>\n\n              <Typography paragraph>\n                The blue and red lines on the chart indicate confirmed cases and deaths, respectively. The faint blue and red lines represent the\n                multiplicative increase in confirmed cases and deaths, respectively, from the following day. The plot's range is 1.0x-1.25x\n                (bottom-top) daily growth factor.\n              </Typography>\n\n              <Typography paragraph>\n                You can click on the globe to limit the chart to a specific region. Clicking outside any region, reverts the chart to global mode.\n              </Typography>\n\n              <Typography paragraph>\n                The chart is draggable and zoomable in the time-axis. Clicking on a point in the chart will revert the visualization to the clicked\n                time. The current time indicator can be dragged for scrubbing purposes.\n              </Typography>\n            </CardContent>\n            <CardActions>\n              <Button size=\"small\" onClick={() => setHelpExpanded(false)}>\n                Dismiss\n              </Button>\n              <Button size=\"small\" onClick={() => setSourcesExpanded(!sourcesExpanded)}>\n                Sources\n              </Button>\n              <Button size=\"small\" onClick={() => setDependenciesExpanded(!dependenciesExpanded)}>\n                Dependencies\n              </Button>\n              <Button size=\"small\" href=\"https://github.com/trylle/covid-viz\">\n                GitHub\n              </Button>\n            </CardActions>\n            <Collapse in={sourcesExpanded} timeout=\"auto\" unmountOnExit>\n              <CardContent className=\"sources\">\n                <Typography paragraph>\n                  The COVID-19 statistics for this visualizer are sourced from{\" \"}\n                  <Link href=\"https://github.com/CSSEGISandData/COVID-19\">JHU CSSE COVID-19 Data</Link>.\n                </Typography>\n\n                <Typography paragraph>\n                  Population density is derived from the{\" \"}\n                  <Link href=\"https://ghsl.jrc.ec.europa.eu/download.php?ds=pop\">Global Human Settlement Layer</Link>. Schiavina, Marcello; Freire,\n                  Sergio; MacManus, Kytt (2019): GHS population grid multitemporal (1975, 1990, 2000, 2015) R2019A. European Commission, Joint\n                  Research Centre (JRC) DOI: 10.2905/42E8BE89-54FF-464E-BE7B-BF9E64DA5218 PID:\n                  http://data.europa.eu/89h/0c6b9751-a71f-4062-830b-43c9f432370f.\n                </Typography>\n\n                <Typography paragraph>\n                  World &amp; US GeoJson data was sourced from <Link href=\"https://github.com/nvkelso/natural-earth-vector\">Natural Earth</Link>.\n                </Typography>\n\n                <Typography paragraph>\n                  China GeoJson data was sourced from <Link href=\"https://gadm.org/download_country_v3.html\">GADM</Link>.\n                </Typography>\n\n                <Typography paragraph>\n                  Bathymetry texture was sourced from{\" \"}\n                  <Link href=\"https://www.naturalearthdata.com/downloads/50m-raster-data/50m-bathymetry\">Natural Earth</Link>.\n                </Typography>\n              </CardContent>\n            </Collapse>\n            <Collapse in={dependenciesExpanded} timeout=\"auto\" unmountOnExit>\n              <CardContent className=\"dependencies\">\n                <Typography paragraph>This application uses the following libraries:</Typography>\n                {Object.keys(licenses ?? {}).map((name) => {\n                  const l = licenses[name];\n\n                  return (\n                    <Typography key={name} paragraph>\n                      <Link href={l.repository}>{name}</Link> licensed as <Link onClick={() => setShownLicense(l.licenseText)}>{l.license}</Link>.\n                    </Typography>\n                  );\n                })}\n              </CardContent>\n            </Collapse>\n          </Card>\n        </div>\n      </Grow>\n      <Backdrop open={shownLicense !== undefined} onClick={() => setShownLicense(undefined)} className=\"license-backdrop\">\n        <Card className=\"license-card\">\n          <CardContent className=\"license-content\">\n            <TextField multiline value={shownLicense} InputProps={{ readOnly: true }} />\n          </CardContent>\n        </Card>\n      </Backdrop>\n    </div>\n  );\n}\n","import React, { useRef, useEffect, useState } from \"react\";\nimport * as THREE from \"three\";\nimport ThreeGlobe from \"three-globe\";\nimport { GeoJsonGeometry } from \"three-geojson-geometry\";\nimport * as geojson from \"geojson\";\nimport * as d3 from \"d3\";\nimport { createMuiTheme, ThemeProvider } from \"@material-ui/core/styles\";\nimport { processStatistics, StatisticsRequests } from \"./processing\";\nimport { initScene, createLatLngClickHandler } from \"./scene\";\nimport { getCountryDensities, CountryDensities } from \"./country-densities\";\nimport { generateDatapoints } from \"./data-points\";\nimport { CovidStatistics, GlobalsType } from \"./types\";\nimport { generateChart } from \"./chart\";\nimport { getCountryFeatures, getFeatureCountry, getFeatureState } from \"./country-features\";\nimport { GLOBE_RADIUS } from \"./three-globe\";\nimport UiOverlay from \"./ui-overlay\";\nimport \"./app.scss\";\n\nconst simulatedDaysPerRealtimeSecond = 4;\nconst msPerTimeUnit = 24 * 60 * 60 * 1000;\n\nfunction App() {\n  const rootElement = useRef<HTMLDivElement>(null);\n  const [scene, setScene] = useState<THREE.Scene>();\n  const [globe, setGlobe] = useState<ThreeGlobe>();\n  const [renderer, setRenderer] = useState<THREE.WebGLRenderer>();\n  const [camera, setCamera] = useState<THREE.PerspectiveCamera>();\n  const [countriesGeoJson, setCountriesGeoJson] = useState<geojson.FeatureCollection>();\n  const [statsConfirmed, setStatsConfirmed] = useState<CovidStatistics>();\n  const [statsRecovered, setStatsRecovered] = useState<CovidStatistics>();\n  const [statsDeaths, setStatsDeaths] = useState<CovidStatistics>();\n  const [countryDensities, setCountryDensities] = useState<CountryDensities[]>();\n  const [selectedRegion, setSelectedRegion] = useState<string>();\n  const [paused, setPaused] = useState<boolean>(true);\n  const [globals] = useState<GlobalsType>({\n    dispatcher: d3.dispatch(\"timeChanged\"),\n    _time: 0,\n    _paused: true,\n    _intervalId: undefined,\n    extinction: 30,\n    useRecoveryData: true,\n    keepDeaths: true,\n    get time() {\n      return this._time;\n    },\n    set time(value) {\n      if (this._time === value) return;\n\n      this._time = value;\n      this.dispatcher.call(\"timeChanged\", null, this._time, this.date);\n    },\n    get date(): Date | undefined {\n      const { startDate } = this;\n\n      if (startDate === undefined) return undefined;\n\n      return new Date(startDate.valueOf() + this.time * msPerTimeUnit);\n    },\n    set date(date: Date | undefined) {\n      const { startDate } = this;\n\n      if (startDate === undefined || date === undefined) return;\n\n      this.time = (date.valueOf() - startDate.valueOf()) / msPerTimeUnit;\n    },\n    get paused() {\n      return this._paused;\n    },\n    set paused(value) {\n      if (value === this.paused) return;\n\n      this._paused = value;\n\n      if (this._intervalId !== undefined) {\n        clearInterval(this._intervalId);\n        this._intervalId = undefined;\n      }\n\n      if (!this.paused) {\n        let lastTime: number | undefined = undefined;\n\n        this._intervalId = setInterval(() => {\n          const date = Date.now();\n\n          const secondsElapsed = (date - (lastTime ?? date)) / 1000;\n\n          lastTime = date;\n\n          globals.time += secondsElapsed * simulatedDaysPerRealtimeSecond;\n        }, 1000 / 60);\n      }\n    },\n  } as any);\n\n  useEffect(() => {\n    const element = rootElement.current;\n\n    if (!element) return;\n\n    const obj = initScene(element);\n\n    setGlobe(obj.globe);\n    setScene(obj.scene);\n    setRenderer(obj.renderer);\n    setCamera(obj.camera);\n  }, []);\n\n  useEffect(() => {\n    if (!countriesGeoJson || !camera || !globe || !renderer) return;\n\n    const onClick = (latlng?: { lat: number; lng: number }) => {\n      if (!latlng) return setSelectedRegion(undefined);\n\n      const geopt: [number, number] = [latlng.lng, latlng.lat];\n\n      const feature = countriesGeoJson?.features?.find?.((f) => {\n        return d3.geoContains(f.geometry, geopt);\n      });\n\n      const countryName = getFeatureCountry(feature);\n      const stateName = getFeatureState(feature);\n\n      setSelectedRegion(stateName ?? countryName);\n    };\n\n    createLatLngClickHandler({ camera, globe, renderer, onClick });\n  }, [countriesGeoJson, renderer, camera, globe]);\n\n  useEffect(() => {\n    if (!scene) return;\n\n    if (globals.selectedRegionLines) {\n      scene?.remove(globals.selectedRegionLines);\n      globals.selectedRegionLines = undefined;\n    }\n\n    if (!countriesGeoJson || !selectedRegion) return;\n\n    const material = new THREE.LineBasicMaterial({ color: \"white\" });\n\n    for (const country of countriesGeoJson.features) {\n      if (getFeatureCountry(country) !== selectedRegion && getFeatureState(country) !== selectedRegion) continue;\n\n      globals.selectedRegionLines = new THREE.LineSegments(\n        new GeoJsonGeometry(country.geometry as any /* messed up types */, GLOBE_RADIUS * 1.001),\n        material\n      );\n\n      scene.add(globals.selectedRegionLines);\n\n      break;\n    }\n  }, [countriesGeoJson, selectedRegion, scene, globals]);\n\n  useEffect(() => {\n    getCountryDensities().then((cd) => setCountryDensities(cd));\n  }, []);\n\n  useEffect(() => {\n    (async () => {\n      setCountriesGeoJson(await getCountryFeatures());\n    })();\n  }, []);\n\n  useEffect(() => {\n    if (!scene || !countriesGeoJson) return;\n\n    const material = new THREE.LineBasicMaterial({ color: \"red\" });\n\n    for (const country of countriesGeoJson.features) {\n      const myLine = new THREE.LineSegments(new GeoJsonGeometry(country.geometry as any /* messed up types */, GLOBE_RADIUS), material);\n\n      scene.add(myLine);\n    }\n  }, [scene, countriesGeoJson]);\n\n  useEffect(() => {\n    if (!countriesGeoJson) return;\n\n    const requests: StatisticsRequests = [\n      {\n        path:\n          \"https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_confirmed_global.csv\",\n        func: setStatsConfirmed,\n      },\n      {\n        path:\n          \"https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_recovered_global.csv\",\n        func: setStatsRecovered,\n      },\n      {\n        path:\n          \"https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_deaths_global.csv\",\n        func: setStatsDeaths,\n      },\n\n      // US\n      {\n        path:\n          \"https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_confirmed_US.csv\",\n        func: setStatsConfirmed,\n      },\n      {\n        path:\n          \"https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_deaths_US.csv\",\n        func: setStatsDeaths,\n      },\n    ];\n\n    processStatistics(requests, countriesGeoJson, globals);\n  }, [globals, countriesGeoJson]);\n\n  useEffect(() => {\n    const element = rootElement.current;\n\n    if (!element || !statsConfirmed || !statsDeaths || !globals) return;\n\n    generateChart({ element, globals, statsConfirmed, statsDeaths, selectedRegion });\n  }, [statsConfirmed, statsDeaths, globals, selectedRegion]);\n\n  useEffect(() => {\n    if (!countryDensities || !scene || !countriesGeoJson || !statsConfirmed || !statsRecovered || !statsDeaths) return;\n\n    const mesh = generateDatapoints(countryDensities, countriesGeoJson, globals, statsConfirmed, statsRecovered, statsDeaths);\n\n    scene.add(mesh);\n\n    setPaused(false);\n  }, [scene, countryDensities, countriesGeoJson, globals, statsConfirmed, statsRecovered, statsDeaths]);\n\n  const theme = React.useMemo(\n    () =>\n      createMuiTheme({\n        palette: {\n          type: \"dark\",\n          primary: {\n            main: \"#648dae\",\n          },\n        },\n      }),\n    []\n  );\n\n  globals.paused = paused;\n\n  return (\n    <ThemeProvider theme={theme}>\n      <div className=\"App\" ref={rootElement}></div>\n      <UiOverlay\n        paused={paused}\n        setPaused={(paused: boolean) => {\n          setPaused(paused);\n        }}\n        globals={globals}\n      />\n    </ThemeProvider>\n  );\n}\n\nexport default App;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(\n      process.env.PUBLIC_URL,\n      window.location.href\n    );\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' }\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then(registration => {\n        registration.unregister();\n      })\n      .catch(error => {\n        console.error(error.message);\n      });\n  }\n}\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport App from \"./app\";\nimport * as serviceWorker from \"./serviceWorker\";\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById(\"root\")\n);\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}